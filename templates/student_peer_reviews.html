{% extends 'base.html' %}

{% block title %}Peer Reviews - Sangrenes LMS{% endblock %}

{% block content %}
<div class="page-header">
    <h1><i class="fas fa-user-friends"></i> My Peer Reviews</h1>
    <a href="{{ url_for('student_dashboard') }}" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Dashboard</a>
</div>

<!-- My Peer Review Scores (what others scored my work) -->
{% if my_scores is defined and my_scores|length > 0 %}
<div class="card">
    <div class="card-header">
        <span class="card-title"><i class="fas fa-chart-bar"></i> My Peer Review Scores</span>
    </div>
    <div class="card-body">
        <p class="pr-subtitle">Scores your classmates gave your submissions:</p>
        {% for score in my_scores %}
        <div class="score-card">
            <div class="score-info">
                <h4>{{ score.activity_title }}</h4>
                <p class="text-muted">{{ score.subject_name }} - {{ score.session_title }}</p>
                <small><i class="fas fa-users"></i> {{ score.reviews_received }} review{{ 's' if score.reviews_received != 1 }} received</small>
            </div>
            <div class="score-display">
                {% set pct = score.peer_review_score|round(1) %}
                <div class="score-circle {% if pct >= 90 %}excellent{% elif pct >= 80 %}good{% elif pct >= 70 %}fair{% else %}low{% endif %}">
                    <span class="score-num">{{ pct }}</span>
                    <span class="score-label">/ 100</span>
                </div>
                {% if pct >= 90 %}
                <span class="score-tag excellent">Excellent</span>
                {% elif pct >= 80 %}
                <span class="score-tag good">Good</span>
                {% elif pct >= 70 %}
                <span class="score-tag fair">Fair</span>
                {% else %}
                <span class="score-tag low">Needs Work</span>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

{% if pending_reviews %}
<div class="card">
    <div class="card-header">
        <span class="card-title"><i class="fas fa-clock"></i> Pending Reviews ({{ pending_reviews|length }})</span>
    </div>
    <div class="card-body">
        {% for review in pending_reviews %}
        <div class="review-item pending">
            <div class="review-info">
                <h4>{{ review.activity_title }}</h4>
                <p class="text-muted">{{ review.subject_name }} - {{ review.session_title }}</p>
                <small>Assigned: {{ review.assigned_at }}</small>
            </div>
            <a href="{{ url_for('do_peer_review', assignment_id=review.id) }}" class="btn">
                <i class="fas fa-edit"></i> Review Now
            </a>
        </div>
        {% endfor %}
    </div>
</div>
{% else %}
<div class="card">
    <div class="card-header">
        <span class="card-title"><i class="fas fa-clock"></i> Pending Reviews</span>
    </div>
    <div class="card-body">
        <div class="empty-state">
            <i class="fas fa-check-circle"></i>
            <p>No pending peer reviews!</p>
        </div>
    </div>
</div>
{% endif %}

<div class="card mt-20">
    <div class="card-header">
        <span class="card-title"><i class="fas fa-check-double"></i> Completed Reviews ({{ completed_reviews|length }})</span>
    </div>
    <div class="card-body">
        {% if completed_reviews %}
        {% for review in completed_reviews %}
        <div class="review-item completed">
            <div class="review-info">
                <h4>{{ review.activity_title }}</h4>
                <p class="text-muted">{{ review.subject_name }} - {{ review.session_title }}</p>
                <small>Completed: {{ review.completed_at }}</small>
            </div>
            <div class="review-score-wrap">
                {% if review.review_score %}
                {% set rs = review.review_score|round(1) %}
                <span class="review-score-badge {% if rs >= 90 %}excellent{% elif rs >= 80 %}good{% elif rs >= 70 %}fair{% else %}low{% endif %}">
                    <i class="fas fa-star"></i> {{ rs }}%
                </span>
                {% endif %}
                <span class="badge badge-success"><i class="fas fa-check"></i> Completed</span>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <div class="empty-state">
            <i class="fas fa-clipboard-list"></i>
            <p>No completed reviews yet</p>
        </div>
        {% endif %}
    </div>
</div>

<style>
/* My Scores Section */
.pr-subtitle {
    color: #6B7280;
    font-size: 0.9rem;
    margin: 0 0 15px 0;
}

.score-card {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px;
    border: 1px solid #E5E7EB;
    border-radius: 10px;
    margin-bottom: 10px;
    border-left: 4px solid #8B5CF6;
    background: #FAFBFF;
}

.score-info h4 { margin: 0 0 4px 0; color: #1E293B; font-size: 1rem; }
.score-info p { margin: 0; font-size: 0.85rem; }
.score-info small { color: #8B5CF6; }

.score-display {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-shrink: 0;
}

.score-circle {
    text-align: center;
    padding: 8px 14px;
    border-radius: 10px;
    background: white;
    border: 2px solid #E5E7EB;
}

.score-circle .score-num {
    font-size: 1.5rem;
    font-weight: 800;
    display: block;
    line-height: 1;
}

.score-circle .score-label {
    font-size: 0.65rem;
    color: #9CA3AF;
}

.score-circle.excellent { border-color: #10B981; }
.score-circle.excellent .score-num { color: #059669; }
.score-circle.good { border-color: #0EA5E9; }
.score-circle.good .score-num { color: #0284C7; }
.score-circle.fair { border-color: #F59E0B; }
.score-circle.fair .score-num { color: #D97706; }
.score-circle.low { border-color: #EF4444; }
.score-circle.low .score-num { color: #DC2626; }

.score-tag {
    font-size: 0.75rem;
    font-weight: 700;
    padding: 4px 10px;
    border-radius: 6px;
}
.score-tag.excellent { background: #D1FAE5; color: #059669; }
.score-tag.good { background: #E0F2FE; color: #0284C7; }
.score-tag.fair { background: #FEF3C7; color: #D97706; }
.score-tag.low { background: #FEE2E2; color: #DC2626; }

/* Review Items */
.review-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    border: 1px solid #eee;
    border-radius: 8px;
    margin-bottom: 10px;
    background: #fff;
}
.review-item.pending {
    border-left: 4px solid #f59e0b;
}
.review-item.completed {
    border-left: 4px solid #10b981;
}
.review-info h4 {
    margin: 0 0 5px 0;
    color: #1e293b;
}
.review-info p {
    margin: 0;
    font-size: 14px;
}

.review-score-wrap {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-shrink: 0;
}

.review-score-badge {
    padding: 5px 12px;
    border-radius: 8px;
    font-size: 0.8rem;
    font-weight: 700;
}
.review-score-badge.excellent { background: #D1FAE5; color: #059669; }
.review-score-badge.good { background: #E0F2FE; color: #0284C7; }
.review-score-badge.fair { background: #FEF3C7; color: #D97706; }
.review-score-badge.low { background: #FEE2E2; color: #DC2626; }
.review-score-badge i { margin-right: 3px; }

.empty-state {
    text-align: center;
    padding: 40px;
    color: #666;
}
.empty-state i {
    font-size: 48px;
    margin-bottom: 15px;
    color: #10b981;
}
.badge-success {
    background: #10b981;
    color: white;
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 12px;
}

@media (max-width: 768px) {
    .score-card { flex-direction: column; align-items: flex-start; gap: 12px; }
    .review-item { flex-direction: column; align-items: flex-start; gap: 10px; }
}
</style>
{% endblock %}
