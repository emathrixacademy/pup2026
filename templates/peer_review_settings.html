{% extends 'base.html' %}

{% block title %}Peer Review Settings - {{ activity.title }}{% endblock %}

{% block content %}
<div class="page-header">
    <h1><i class="fas fa-users-cog"></i> Peer Review Settings</h1>
    <a href="javascript:history.back()" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Back</a>
</div>

<div class="card">
    <div class="card-header">
        <span class="card-title">{{ activity.title }}</span>
    </div>
    <div class="card-body">
        <form action="{{ url_for('peer_review_settings', activity_id=activity.id) }}" method="POST">
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" name="enable_peer_review" value="1"
                           {% if activity.enable_peer_review %}checked{% endif %}>
                    <span class="checkmark"></span>
                    Enable Peer Review for this Activity
                </label>
            </div>
            <div class="form-group">
                <label>Number of Reviewers per Submission</label>
                <input type="number" name="peer_reviewers_count"
                       value="{{ activity.peer_reviewers_count or 1 }}"
                       min="1" max="5" class="form-control" style="max-width: 100px;">
                <small>Each submission will be reviewed by this many classmates</small>
            </div>
            <button type="submit" class="btn"><i class="fas fa-save"></i> Save Settings</button>
        </form>
    </div>
</div>

<div class="card mt-20">
    <div class="card-header">
        <span class="card-title"><i class="fas fa-clipboard-check"></i> Review Criteria</span>
    </div>
    <div class="card-body">
        <p class="mb-20">Add criteria that reviewers will check. Each criterion is a question that reviewers will answer with "Yes", "Somehow", or "No".</p>

        {% if criteria %}
        <table class="table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Criterion</th>
                    <th>Points</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for c in criteria %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td>{{ c.criterion }}</td>
                    <td>{{ c.points }} pts</td>
                    <td>
                        <form action="{{ url_for('delete_peer_review_criteria', activity_id=activity.id, criterion_id=c.id) }}"
                              method="POST" style="display: inline;">
                            <button type="submit" class="btn btn-danger btn-sm"
                                    onclick="return confirm('Delete this criterion?')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="empty-state">
            <i class="fas fa-clipboard-list"></i>
            <p>No criteria added yet. Add criteria below.</p>
        </div>
        {% endif %}

        <hr class="mt-20 mb-20">

        <h4>Add New Criterion</h4>
        <form action="{{ url_for('add_peer_review_criteria', activity_id=activity.id) }}" method="POST">
            <div class="flex gap-10 align-items-end">
                <div class="form-group" style="flex: 3;">
                    <label>Criterion Question</label>
                    <input type="text" name="criterion" placeholder="e.g., Does the code follow proper naming conventions?" required>
                </div>
                <div class="form-group" style="flex: 1;">
                    <label>Points</label>
                    <input type="number" name="points" value="1" min="1" max="10" required>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn"><i class="fas fa-plus"></i> Add</button>
                </div>
            </div>
        </form>
    </div>
</div>

{% if criteria %}
<div class="card mt-20">
    <div class="card-header">
        <span class="card-title"><i class="fas fa-random"></i> Assign Reviewers</span>
    </div>
    <div class="card-body">
        <p>Once students have submitted their work, click the button below to randomly assign peer reviewers.</p>
        <form action="{{ url_for('assign_peer_reviewers', activity_id=activity.id) }}" method="POST" class="mt-20">
            <button type="submit" class="btn btn-warning" onclick="return confirm('This will reassign all peer reviews. Continue?')">
                <i class="fas fa-random"></i> Randomly Assign Peer Reviewers
            </button>
        </form>
        <a href="{{ url_for('peer_review_status', activity_id=activity.id) }}" class="btn btn-secondary mt-10">
            <i class="fas fa-chart-bar"></i> View Peer Review Status
        </a>
    </div>
</div>
{% endif %}

<style>
.checkbox-label {
    display: flex;
    align-items: center;
    cursor: pointer;
    font-size: 16px;
}
.checkbox-label input[type="checkbox"] {
    margin-right: 10px;
    width: 20px;
    height: 20px;
}
.empty-state {
    text-align: center;
    padding: 40px;
    color: #666;
}
.empty-state i {
    font-size: 48px;
    margin-bottom: 15px;
    color: #ccc;
}
hr {
    border: none;
    border-top: 1px solid #eee;
}
.align-items-end {
    align-items: flex-end;
}
</style>
{% endblock %}
