{% extends 'base.html' %}

{% block title %}Dashboard - Sangrenes LMS{% endblock %}

{% block content %}
<!-- Pending Alert -->
{% if stats.pending > 0 %}
<div style="background:#FFFBEB;border:1px solid #FDE68A;border-radius:10px;padding:14px 20px;margin-bottom:20px;display:flex;align-items:center;gap:12px;">
    <div style="width:40px;height:40px;background:#F59E0B;color:white;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-shrink:0;"><i class="fas fa-user-clock"></i></div>
    <div style="flex:1;"><strong style="color:#92400E;">{{ stats.pending }} pending enrollment{{ 's' if stats.pending != 1 }}</strong><br><span style="font-size:0.82rem;color:#B45309;">Students waiting for approval</span></div>
    <a href="{{ url_for('enrollments') }}" style="padding:8px 16px;background:#F59E0B;color:white;border-radius:8px;font-size:0.82rem;font-weight:600;text-decoration:none;">Review</a>
</div>
{% endif %}

<!-- Stats Row -->
<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:12px;margin-bottom:24px;">
    <div style="background:var(--card);border:1px solid var(--border);border-radius:10px;padding:18px;text-align:center;">
        <div style="font-size:1.8rem;font-weight:700;color:var(--primary);">{{ stats.students }}</div>
        <div style="font-size:0.78rem;color:var(--muted);"><i class="fas fa-user-graduate"></i> Students</div>
    </div>
    <div style="background:var(--card);border:1px solid var(--border);border-radius:10px;padding:18px;text-align:center;">
        <div style="font-size:1.8rem;font-weight:700;color:#10B981;">{{ stats.subjects }}</div>
        <div style="font-size:0.78rem;color:var(--muted);"><i class="fas fa-chalkboard"></i> Classes</div>
    </div>
    <div style="background:var(--card);border:1px solid var(--border);border-radius:10px;padding:18px;text-align:center;">
        <div style="font-size:1.8rem;font-weight:700;color:#F59E0B;">{{ stats.sessions }}</div>
        <div style="font-size:0.78rem;color:var(--muted);"><i class="fas fa-book-open"></i> Sessions</div>
    </div>
    <div style="background:var(--card);border:1px solid var(--border);border-radius:10px;padding:18px;text-align:center;">
        <div style="font-size:1.8rem;font-weight:700;color:#8B5CF6;">{{ stats.activities }}</div>
        <div style="font-size:0.78rem;color:var(--muted);"><i class="fas fa-tasks"></i> Activities</div>
    </div>
    <div style="background:var(--card);border:1px solid var(--border);border-radius:10px;padding:18px;text-align:center;">
        <div style="font-size:1.8rem;font-weight:700;color:#EF4444;">{{ stats.quizzes }}</div>
        <div style="font-size:0.78rem;color:var(--muted);"><i class="fas fa-question-circle"></i> Quizzes</div>
    </div>
</div>

<!-- Two-column: Classes + Monitoring -->
<div style="display:grid;grid-template-columns:1fr 360px;gap:20px;align-items:start;">
    <!-- My Classes -->
    <div>
        <h2 style="font-size:1rem;font-weight:600;margin:0 0 14px;color:var(--text);"><i class="fas fa-chalkboard-teacher" style="color:var(--primary);"></i> My Classes</h2>
        <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px;">
            {% set colors = ['#6366F1','#10B981','#8B5CF6','#F59E0B','#EF4444','#3B82F6'] %}
            {% for subject in subjects %}
            <div style="background:var(--card);border:1px solid var(--border);border-radius:12px;overflow:hidden;">
                <div style="background:{{ colors[loop.index0 % 6] }};padding:16px 18px;color:white;">
                    <div style="font-size:0.72rem;opacity:0.85;"><i class="fas fa-clock"></i> {{ subject.day }} {{ subject.time_schedule }}</div>
                    <div style="font-size:1.05rem;font-weight:700;margin-top:4px;">{{ subject.code }}</div>
                    <div style="font-size:0.82rem;opacity:0.9;">{{ subject.name }}</div>
                    <div style="font-size:0.75rem;opacity:0.8;margin-top:2px;">{{ subject.section }}</div>
                </div>
                <div style="padding:12px 18px;display:flex;gap:8px;flex-wrap:wrap;">
                    <a href="{{ url_for('subject_detail', id=subject.id) }}" style="padding:5px 12px;font-size:0.75rem;background:var(--primary-light);color:var(--primary);border-radius:6px;text-decoration:none;font-weight:500;"><i class="fas fa-folder-open"></i> Sessions</a>
                    <a href="{{ url_for('all_activities', subject_id=subject.id) }}" style="padding:5px 12px;font-size:0.75rem;background:#F1F5F9;color:var(--muted);border-radius:6px;text-decoration:none;font-weight:500;"><i class="fas fa-tasks"></i> Activities</a>
                    <a href="{{ url_for('subject_exams', subject_id=subject.id) }}" style="padding:5px 12px;font-size:0.75rem;background:#F1F5F9;color:var(--muted);border-radius:6px;text-decoration:none;font-weight:500;"><i class="fas fa-file-alt"></i> Exams</a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Monitoring Panel -->
    <div style="background:var(--card);border:1px solid var(--border);border-radius:12px;overflow:hidden;">
        <div style="padding:14px 18px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;">
            <h3 style="margin:0;font-size:0.9rem;font-weight:600;"><i class="fas fa-shield-alt" style="color:#EF4444;"></i> Student Monitoring</h3>
        </div>

        <!-- Summary -->
        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:0;border-bottom:1px solid var(--border);">
            <div style="padding:14px;text-align:center;border-right:1px solid var(--border);">
                <div style="font-size:1.4rem;font-weight:700;color:#EF4444;">{{ at_risk_count }}</div>
                <div style="font-size:0.7rem;color:var(--muted);">At Risk</div>
            </div>
            <div style="padding:14px;text-align:center;border-right:1px solid var(--border);">
                <div style="font-size:1.4rem;font-weight:700;color:#F59E0B;">{{ missed_count }}</div>
                <div style="font-size:0.7rem;color:var(--muted);">Missed</div>
            </div>
            <div style="padding:14px;text-align:center;">
                <div style="font-size:1.4rem;font-weight:700;color:#8B5CF6;">{{ low_grade_count }}</div>
                <div style="font-size:0.7rem;color:var(--muted);">Low Grade</div>
            </div>
        </div>

        <!-- At-risk students list -->
        {% if at_risk_list %}
        <div style="max-height:400px;overflow-y:auto;">
            {% for s in at_risk_list %}
            <div style="padding:12px 18px;border-bottom:1px solid #F1F5F9;display:flex;gap:10px;align-items:flex-start;">
                <div style="width:32px;height:32px;background:#FEE2E2;color:#EF4444;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:0.7rem;font-weight:700;flex-shrink:0;">{{ s.grade|int if s.grade else '?' }}%</div>
                <div style="flex:1;min-width:0;">
                    <div style="font-size:0.82rem;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">{{ s.name }}</div>
                    <div style="font-size:0.72rem;color:var(--muted);">{{ s.subject }} &middot; {{ s.section or '' }}</div>
                    {% for issue in s.issues %}
                    <span style="display:inline-block;font-size:0.68rem;padding:1px 8px;border-radius:4px;margin-top:3px;{% if 'Failing' in issue %}background:#FEE2E2;color:#991B1B;{% else %}background:#FEF3C7;color:#92400E;{% endif %}">{{ issue }}</span>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div style="padding:40px;text-align:center;color:var(--muted);">
            <i class="fas fa-check-circle" style="font-size:2rem;color:#10B981;margin-bottom:8px;display:block;"></i>
            <div style="font-size:0.85rem;">All students on track</div>
        </div>
        {% endif %}
    </div>
</div>

<style>
@media (max-width: 900px) {
    div[style*="grid-template-columns:1fr 360px"] { grid-template-columns: 1fr !important; }
}
</style>
{% endblock %}
