{% extends 'base.html' %}
{% block title %}Institution Dashboard - Sangrenes LMS{% endblock %}
{% block content %}
<div style="display:flex;align-items:center;gap:12px;margin-bottom:20px;">
    <div style="width:48px;height:48px;background:var(--primary);color:white;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.3rem;"><i class="fas fa-building"></i></div>
    <div>
        <h1 style="font-size:1.2rem;font-weight:700;margin:0;">{{ institution.name if institution else 'My Institution' }}</h1>
        <span style="font-size:0.78rem;color:var(--muted);">{{ institution.short_name if institution else '' }} &middot; Institution Dashboard</span>
    </div>
</div>

<!-- Stats -->
<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:12px;margin-bottom:24px;">
    <div style="background:var(--card);border:1px solid var(--border);border-radius:10px;padding:18px;text-align:center;">
        <div style="font-size:1.8rem;font-weight:700;color:var(--primary);">{{ teacher_count }}</div>
        <div style="font-size:0.78rem;color:var(--muted);"><i class="fas fa-chalkboard-teacher"></i> Teachers</div>
    </div>
    <div style="background:var(--card);border:1px solid var(--border);border-radius:10px;padding:18px;text-align:center;">
        <div style="font-size:1.8rem;font-weight:700;color:#10B981;">{{ student_count }}</div>
        <div style="font-size:0.78rem;color:var(--muted);"><i class="fas fa-users"></i> Students</div>
    </div>
    <div style="background:var(--card);border:1px solid var(--border);border-radius:10px;padding:18px;text-align:center;">
        <div style="font-size:1.8rem;font-weight:700;color:#F59E0B;">{{ subject_count }}</div>
        <div style="font-size:0.78rem;color:var(--muted);"><i class="fas fa-book-open"></i> Subjects</div>
    </div>
    <div style="background:var(--card);border:1px solid var(--border);border-radius:10px;padding:18px;text-align:center;">
        <div style="font-size:1.8rem;font-weight:700;color:#8B5CF6;">{{ session_count }}</div>
        <div style="font-size:0.78rem;color:var(--muted);"><i class="fas fa-book"></i> Sessions</div>
    </div>
    <div style="background:var(--card);border:1px solid var(--border);border-radius:10px;padding:18px;text-align:center;">
        <div style="font-size:1.8rem;font-weight:700;color:#EF4444;">{{ activity_count }}</div>
        <div style="font-size:0.78rem;color:var(--muted);"><i class="fas fa-tasks"></i> Activities</div>
    </div>
</div>

<!-- Revenue -->
<div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:24px;">
    <div style="background:linear-gradient(135deg,#10B981,#059669);border-radius:12px;padding:20px;color:white;">
        <div style="font-size:0.8rem;opacity:0.85;">Total Revenue</div>
        <div style="font-size:2rem;font-weight:800;">P{{ "{:,.2f}".format(total_revenue) }}</div>
    </div>
    <div style="background:linear-gradient(135deg,#F59E0B,#D97706);border-radius:12px;padding:20px;color:white;">
        <div style="font-size:0.8rem;opacity:0.85;">Pending Payments</div>
        <div style="font-size:2rem;font-weight:800;">P{{ "{:,.2f}".format(total_pending) }}</div>
    </div>
</div>

<!-- Recent -->
<div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;">
    <div style="background:var(--card);border:1px solid var(--border);border-radius:12px;overflow:hidden;">
        <div style="padding:14px 18px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;">
            <h3 style="margin:0;font-size:0.9rem;font-weight:600;"><i class="fas fa-chalkboard-teacher" style="color:var(--primary);"></i> Recent Teachers</h3>
            <a href="{{ url_for('inst_teachers') }}" style="font-size:0.75rem;color:var(--primary);text-decoration:none;">View All</a>
        </div>
        {% for t in recent_teachers %}
        <div style="padding:10px 18px;border-bottom:1px solid #F1F5F9;display:flex;align-items:center;gap:10px;">
            <img src="{{ url_for('static', filename='uploads/photos/' + (t.photo or 'default.png')) }}" onerror="this.src='https://ui-avatars.com/api/?name={{ t.full_name }}&background=6366F1&color=fff&size=32'" style="width:32px;height:32px;border-radius:50%;object-fit:cover;">
            <div><div style="font-size:0.85rem;font-weight:600;">{{ t.full_name }}</div><div style="font-size:0.72rem;color:var(--muted);">{{ t.email or t.username }}</div></div>
        </div>
        {% else %}
        <div style="padding:30px;text-align:center;color:var(--muted);font-size:0.82rem;">No teachers added yet.</div>
        {% endfor %}
    </div>
    <div style="background:var(--card);border:1px solid var(--border);border-radius:12px;overflow:hidden;">
        <div style="padding:14px 18px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;">
            <h3 style="margin:0;font-size:0.9rem;font-weight:600;"><i class="fas fa-users" style="color:#10B981;"></i> Recent Students</h3>
            <a href="{{ url_for('inst_students') }}" style="font-size:0.75rem;color:var(--primary);text-decoration:none;">View All</a>
        </div>
        {% for s in recent_students %}
        <div style="padding:10px 18px;border-bottom:1px solid #F1F5F9;display:flex;align-items:center;gap:10px;">
            <img src="{{ url_for('static', filename='uploads/photos/' + (s.photo or 'default.png')) }}" onerror="this.src='https://ui-avatars.com/api/?name={{ s.full_name }}&background=10B981&color=fff&size=32'" style="width:32px;height:32px;border-radius:50%;object-fit:cover;">
            <div><div style="font-size:0.85rem;font-weight:600;">{{ s.full_name }}</div><div style="font-size:0.72rem;color:var(--muted);">{{ s.section or '' }} &middot; {{ s.student_id or '' }}</div></div>
        </div>
        {% else %}
        <div style="padding:30px;text-align:center;color:var(--muted);font-size:0.82rem;">No students added yet.</div>
        {% endfor %}
    </div>
</div>
{% endblock %}
