{% extends 'base.html' %}

{% block title %}My Payroll - eMathrix LMS{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <h1><i class="fas fa-wallet"></i> My Payroll</h1>
        <p>View your salary information and pay history</p>
    </div>
</div>

<!-- Salary Info + Attendance Summary -->
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 24px;">
    <!-- Salary Card -->
    <div style="background: linear-gradient(135deg, #8B5CF6, #6D28D9); border-radius: 12px; padding: 24px; color: white; box-shadow: 0 4px 12px rgba(139,92,246,0.3);">
        <div style="font-size: 0.85rem; opacity: 0.8; margin-bottom: 4px;"><i class="fas fa-money-bill-wave"></i> My Salary Rate</div>
        {% if profile and profile.salary_rate %}
        <div style="font-size: 2rem; font-weight: 700;">&#8369;{{ "{:,.2f}".format(profile.salary_rate) }}</div>
        <div style="font-size: 0.85rem; opacity: 0.8; margin-top: 4px;">{{ profile.salary_frequency or 'monthly' }} &middot; {{ profile.contract_type or 'full-time' }}</div>
        {% else %}
        <div style="font-size: 1.2rem; font-weight: 600; margin-top: 8px;">Not configured yet</div>
        <div style="font-size: 0.8rem; opacity: 0.7; margin-top: 4px;">Contact admin to set up your salary profile</div>
        {% endif %}
    </div>

    <!-- This Month Attendance -->
    <div style="background: white; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
        <div style="font-size: 0.85rem; color: #64748B; margin-bottom: 12px;"><i class="fas fa-calendar-check" style="color: #3B82F6;"></i> This Month Attendance</div>
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; text-align: center;">
            <div>
                <div style="font-size: 1.5rem; font-weight: 700; color: #10B981;">{{ attendance_summary.present or 0 }}</div>
                <div style="font-size: 0.7rem; color: #94A3B8;">Present</div>
            </div>
            <div>
                <div style="font-size: 1.5rem; font-weight: 700; color: #F59E0B;">{{ attendance_summary.late or 0 }}</div>
                <div style="font-size: 0.7rem; color: #94A3B8;">Late</div>
            </div>
            <div>
                <div style="font-size: 1.5rem; font-weight: 700; color: #EF4444;">{{ attendance_summary.absent or 0 }}</div>
                <div style="font-size: 0.7rem; color: #94A3B8;">Absent</div>
            </div>
            <div>
                <div style="font-size: 1.5rem; font-weight: 700; color: #3B82F6;">{{ "%.1f"|format(attendance_summary.total_hours or 0) }}</div>
                <div style="font-size: 0.7rem; color: #94A3B8;">Hours</div>
            </div>
        </div>
    </div>
</div>

<!-- Payroll History -->
<div style="background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); overflow: hidden;">
    <div style="padding: 16px 20px; border-bottom: 1px solid #E2E8F0;">
        <h3 style="margin: 0; font-size: 1rem;"><i class="fas fa-history" style="color: #8B5CF6;"></i> Pay History</h3>
    </div>
    {% if payrolls %}
    <div style="overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse; min-width: 700px;">
            <thead>
                <tr style="background: #F8FAFC;">
                    <th style="padding: 10px 14px; text-align: left; font-size: 0.8rem; color: #64748B;">Period</th>
                    <th style="padding: 10px 14px; text-align: right; font-size: 0.8rem; color: #64748B;">Base Salary</th>
                    <th style="padding: 10px 14px; text-align: center; font-size: 0.8rem; color: #64748B;">Days</th>
                    <th style="padding: 10px 14px; text-align: right; font-size: 0.8rem; color: #64748B;">Deductions</th>
                    <th style="padding: 10px 14px; text-align: right; font-size: 0.8rem; color: #64748B;">Gross Pay</th>
                    <th style="padding: 10px 14px; text-align: right; font-size: 0.8rem; color: #64748B;">Net Pay</th>
                    <th style="padding: 10px 14px; text-align: center; font-size: 0.8rem; color: #64748B;">Status</th>
                </tr>
            </thead>
            <tbody>
                {% for p in payrolls %}
                <tr style="border-bottom: 1px solid #F1F5F9;">
                    <td style="padding: 12px 14px;">
                        <div style="font-weight: 600; font-size: 0.85rem;">{{ p.period_start }} - {{ p.period_end }}</div>
                    </td>
                    <td style="padding: 12px 14px; text-align: right;">&#8369;{{ "{:,.2f}".format(p.base_salary) }}</td>
                    <td style="padding: 12px 14px; text-align: center; font-size: 0.85rem;">
                        <span style="color: #10B981;">{{ p.days_present }}P</span> /
                        <span style="color: #EF4444;">{{ p.days_absent }}A</span> /
                        <span style="color: #F59E0B;">{{ p.days_late }}L</span>
                    </td>
                    <td style="padding: 12px 14px; text-align: right; color: #EF4444;">-&#8369;{{ "{:,.2f}".format(p.deductions) }}</td>
                    <td style="padding: 12px 14px; text-align: right;">&#8369;{{ "{:,.2f}".format(p.gross_pay) }}</td>
                    <td style="padding: 12px 14px; text-align: right; font-weight: 700; color: #10B981;">&#8369;{{ "{:,.2f}".format(p.net_pay) }}</td>
                    <td style="padding: 12px 14px; text-align: center;">
                        {% if p.status == 'paid' %}
                        <span style="background: #D1FAE5; color: #065F46; padding: 2px 10px; border-radius: 12px; font-size: 0.75rem;">Paid</span>
                        {% elif p.status == 'approved' %}
                        <span style="background: #DBEAFE; color: #1E40AF; padding: 2px 10px; border-radius: 12px; font-size: 0.75rem;">Approved</span>
                        {% else %}
                        <span style="background: #F1F5F9; color: #64748B; padding: 2px 10px; border-radius: 12px; font-size: 0.75rem;">Processing</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div style="padding: 60px; text-align: center; color: #94A3B8;">
        <i class="fas fa-wallet" style="font-size: 3rem; margin-bottom: 16px; color: #CBD5E1;"></i>
        <h3 style="color: #64748B;">No payroll records yet</h3>
        <p>Your payroll will appear here once the admin processes it.</p>
    </div>
    {% endif %}
</div>
{% endblock %}
