{% extends 'base.html' %}

{% block title %}Students - Sangrenes LMS Portal{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <h1><i class="fas fa-users"></i> Student Management</h1>
        <p>Manage student accounts and enrollments</p>
    </div>
    <button class="btn btn-success" onclick="openModal('addStudentModal')">
        <i class="fas fa-user-plus"></i> Add Student
    </button>
</div>

<div class="card">
    <div class="card-header">
        <span class="card-title">All Students ({{ students|length }})</span>
    </div>
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Student ID</th>
                    <th>Full Name</th>
                    <th>Username</th>
                    <th>Section</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for student in students %}
                <tr>
                    <td>{{ student.student_id }}</td>
                    <td>{{ student.full_name }}</td>
                    <td>{{ student.username }}</td>
                    <td>{{ student.section }}</td>
                    <td>
                        <a href="{{ url_for('manage_enrollments', student_id=student.id) }}" class="btn btn-sm btn-primary" title="Manage Subjects">
                            <i class="fas fa-book"></i> Enroll
                        </a>
                        <a href="{{ url_for('student_grades', student_id=student.id) }}" class="btn btn-sm btn-teal" title="View Grades">
                            <i class="fas fa-chart-bar"></i> Grades
                        </a>
                        <a href="{{ url_for('delete_student', id=student.id) }}" class="btn btn-sm btn-danger" onclick="return confirmDelete('Delete this student?')" title="Delete Student">
                            <i class="fas fa-trash"></i>
                        </a>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="5" class="text-center">No students yet. Add students individually or upload a file.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Bulk Upload Section -->
<div class="upload-section">
    <h3>Bulk Upload Students</h3>
    <p>Upload an Excel (.xlsx) or CSV file with columns: student_id, username, password, full_name, section</p>
    <form action="{{ url_for('bulk_upload_students') }}" method="POST" enctype="multipart/form-data" class="mt-20">
        <input type="file" name="file" accept=".xlsx,.xls,.csv" required>
        <button type="submit" class="btn btn-amber mt-20">Upload File</button>
    </form>
</div>

<!-- Add Student Modal -->
<div id="addStudentModal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h3><i class="fas fa-user-plus"></i> Add New Student</h3>
            <span class="modal-close" onclick="closeModal('addStudentModal')">&times;</span>
        </div>
        <form action="{{ url_for('add_student') }}" method="POST">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div class="form-group">
                    <label><i class="fas fa-id-card"></i> Student ID</label>
                    <input type="text" name="student_id" placeholder="e.g., 2021-00001" required>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-user"></i> Full Name</label>
                    <input type="text" name="full_name" placeholder="Juan Dela Cruz" required>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-at"></i> Username</label>
                    <input type="text" name="username" placeholder="jdelacruz" required>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-lock"></i> Password</label>
                    <input type="password" name="password" placeholder="********" required>
                </div>
                <div class="form-group" style="grid-column: span 2;">
                    <label><i class="fas fa-users"></i> Section</label>
                    <input type="text" name="section" placeholder="e.g., BSIT-SR 3-1">
                </div>
            </div>

            <div class="form-group" style="margin-top: 1rem;">
                <label><i class="fas fa-book"></i> Enroll in Subjects</label>
                <p style="font-size: 0.85rem; color: var(--text-gray); margin-bottom: 0.5rem;">
                    Select the subjects this student will be enrolled in:
                </p>
                <div class="subject-checkboxes" style="max-height: 200px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 8px; padding: 1rem;">
                    {% for subject in subjects %}
                    <label class="checkbox-label" style="display: flex; align-items: center; padding: 0.5rem; margin-bottom: 0.25rem; cursor: pointer; border-radius: 4px; transition: background 0.2s;">
                        <input type="checkbox" name="subjects" value="{{ subject.id }}" style="margin-right: 0.75rem; width: 18px; height: 18px;">
                        <span>
                            <strong>{{ subject.code }}</strong> - {{ subject.name }}
                            <small style="display: block; color: var(--text-gray);">{{ subject.section }} | {{ subject.day }} {{ subject.time_schedule }}</small>
                        </span>
                    </label>
                    {% endfor %}
                </div>
            </div>

            <button type="submit" class="btn btn-success btn-full" style="margin-top: 1rem;">
                <i class="fas fa-check"></i> Add Student & Enroll
            </button>
        </form>
    </div>
</div>

<style>
.checkbox-label:hover {
    background: var(--bg-light);
}
.checkbox-label input:checked + span {
    color: var(--primary-blue);
}
</style>
{% endblock %}
