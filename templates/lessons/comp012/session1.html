{% extends 'base.html' %}

{% block title %}Session {{ session.session_number }}: {{ session.title }}{% endblock %}

{% block content %}

<!-- Progress Stepper -->
{% if current_user.role == 'student' and progress %}
<div style="max-width: 1100px; margin: 0 auto; padding: 0 20px;">
    {% include 'includes/progress_stepper.html' %}
</div>
{% endif %}

{% if session.youtube_url %}
<div class="video-section" style="max-width: 1100px; margin: 0 auto 1.5rem; padding: 0 20px;">
    <div style="background: white; border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); overflow: hidden;">
        <div style="padding: 16px 20px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid #E2E8F0;">
            <h3 style="margin: 0; font-size: 1.1rem; color: #1E293B;">
                <i class="fab fa-youtube" style="color: #FF0000;"></i> Session Video
            </h3>
            {% if current_user.role == 'student' %}
                {% if video_watched %}
                <span class="badge badge-visible"><i class="fas fa-check-circle"></i> Watched</span>
                {% else %}
                <span class="badge badge-hidden"><i class="fas fa-exclamation-circle"></i> Must watch to unlock slides</span>
                {% endif %}
            {% endif %}
        </div>
        <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
            <div id="ytPlayer" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></div>
        </div>
        {% if current_user.role == 'student' %}
        <div id="videoProgressBar" style="padding: 10px 20px; background: #F8FAFC; border-top: 1px solid #E2E8F0;">
            <div style="display: flex; align-items: center; gap: 12px;">
                <span style="font-size: 0.85rem; color: #64748B; white-space: nowrap;">
                    <i class="fas fa-clock"></i> Watched: <span id="watchedTime">{{ video_watch_seconds // 60 }}:{{ '%02d' % (video_watch_seconds % 60) }}</span>
                    / <span id="totalDuration">--:--</span>
                </span>
                <div style="flex: 1; background: #E2E8F0; border-radius: 10px; height: 8px; overflow: hidden;">
                    <div id="watchProgressFill" style="height: 100%; background: linear-gradient(90deg, #3B82F6, #10B981); border-radius: 10px; transition: width 0.5s; width: 0%;"></div>
                </div>
                {% if video_watched %}
                <span class="badge badge-visible" style="font-size: 0.75rem;"><i class="fas fa-check"></i> Complete</span>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endif %}

<!-- Slides Section: locked until video is complete for students -->
{% if current_user.role == 'student' and progress and not progress.get('step_video') %}
<div style="max-width: 1100px; margin: 1.5rem auto; padding: 0 20px;">
    <div style="background: white; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); padding: 3rem 2rem; text-align: center;">
        <i class="fas fa-lock" style="font-size: 3rem; color: #CBD5E1; margin-bottom: 1rem;"></i>
        <h3 style="color: #475569; margin: 0 0 0.5rem;">Slides Locked</h3>
        <p style="color: #94A3B8; margin: 0;">Watch the entire video above to unlock the presentation slides.</p>
    </div>
</div>
{% else %}
<div class="lesson-wrapper">
    <!-- Progress Bar -->
    <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
        <span class="progress-text"><span id="currentSlide">1</span> / <span id="totalSlides">10</span></span>
    </div>

    <!-- Slide Container -->
    <div class="slides-container" id="slidesContainer">

        <!-- SLIDE 1: Title Slide -->
        <div class="slide active" data-slide="1">
            <div class="slide-bg-animated"></div>
            <div class="floating-symbols">
                <span class="symbol" style="--delay: 0s; --x: 10%; --y: 20%;">TCP</span>
                <span class="symbol" style="--delay: 0.5s; --x: 80%; --y: 15%;">IP</span>
                <span class="symbol" style="--delay: 1s; --x: 15%; --y: 70%;">LAN</span>
                <span class="symbol" style="--delay: 1.5s; --x: 75%; --y: 65%;">WAN</span>
                <span class="symbol" style="--delay: 2s; --x: 50%; --y: 30%;">VLAN</span>
                <span class="symbol" style="--delay: 2.5s; --x: 85%; --y: 45%;">DNS</span>
            </div>
            <div class="title-content">
                <div class="course-badge">COMP 012 - Session {{ session.session_number }}</div>
                <h1 class="main-title typewriter">Introduction to</h1>
                <h1 class="main-title typewriter delay">Network Administration</h1>
                <p class="subtitle fade-in-delayed">"Managing the Backbone of Modern Business"</p>
                <button class="start-btn pulse" onclick="nextSlide()">
                    <span class="play-icon">&#9654;</span> Start Learning
                </button>
            </div>
        </div>

        <!-- SLIDE 2: Learning Objectives -->
        <div class="slide" data-slide="2">
            <div class="slide-header">
                <div class="lightbulb-icon glow-animation">&#127919;</div>
                <h2>LEARNING OBJECTIVES</h2>
            </div>
            <div class="objectives-container">
                <div class="objective-card" style="--delay: 0.2s">
                    <div class="obj-number">1</div>
                    <div class="obj-icon">&#128104;&#8205;&#128187;</div>
                    <div class="obj-content">
                        <span class="key-term">NETWORK ADMIN</span>
                        <p>Understand the role and responsibilities of a Network Administrator</p>
                    </div>
                    <div class="obj-check">&#10003;</div>
                </div>
                <div class="objective-card" style="--delay: 0.5s">
                    <div class="obj-number">2</div>
                    <div class="obj-icon">&#128202;</div>
                    <div class="obj-content">
                        <span class="key-term">OSI & TCP/IP</span>
                        <p>Review the OSI and TCP/IP network models</p>
                    </div>
                    <div class="obj-check">&#10003;</div>
                </div>
                <div class="objective-card" style="--delay: 0.8s">
                    <div class="obj-number">3</div>
                    <div class="obj-icon">&#128736;</div>
                    <div class="obj-content">
                        <span class="key-term">LAB SETUP</span>
                        <p>Set up your lab environment (VirtualBox + Packet Tracer)</p>
                    </div>
                    <div class="obj-check">&#10003;</div>
                </div>
                <div class="objective-card" style="--delay: 1.1s">
                    <div class="obj-number">4</div>
                    <div class="obj-icon">&#128421;</div>
                    <div class="obj-content">
                        <span class="key-term">COMMANDS</span>
                        <p>Learn essential network troubleshooting commands</p>
                    </div>
                    <div class="obj-check">&#10003;</div>
                </div>
            </div>
        </div>

        <!-- SLIDE 3: What Does a Network Admin Do? -->
        <div class="slide" data-slide="3">
            <h2 class="slide-title">&#128104;&#8205;&#128187; What Does a <span class="key-term">NETWORK ADMIN</span> Do?</h2>
            <div class="role-grid">
                <div class="role-card" onclick="this.classList.toggle('flipped')">
                    <div class="role-icon">&#128295;</div>
                    <h3>MAINTAIN</h3>
                    <ul class="role-tasks">
                        <li>Configure devices</li>
                        <li>Update firmware</li>
                        <li>Repair issues</li>
                    </ul>
                </div>
                <div class="role-card" onclick="this.classList.toggle('flipped')">
                    <div class="role-icon">&#128737;</div>
                    <h3>SECURE</h3>
                    <ul class="role-tasks">
                        <li>Firewalls</li>
                        <li>ACLs</li>
                        <li>VPNs</li>
                    </ul>
                </div>
                <div class="role-card" onclick="this.classList.toggle('flipped')">
                    <div class="role-icon">&#128202;</div>
                    <h3>MONITOR</h3>
                    <ul class="role-tasks">
                        <li>Performance</li>
                        <li>Bandwidth</li>
                        <li>Uptime</li>
                    </ul>
                </div>
                <div class="role-card" onclick="this.classList.toggle('flipped')">
                    <div class="role-icon">&#128680;</div>
                    <h3>TROUBLESHOOT</h3>
                    <ul class="role-tasks">
                        <li>Diagnose</li>
                        <li>Resolve</li>
                        <li>Prevent</li>
                    </ul>
                </div>
                <div class="role-card" onclick="this.classList.toggle('flipped')">
                    <div class="role-icon">&#128203;</div>
                    <h3>DOCUMENT</h3>
                    <ul class="role-tasks">
                        <li>Topology</li>
                        <li>Configs</li>
                        <li>Procedures</li>
                    </ul>
                </div>
                <div class="role-card" onclick="this.classList.toggle('flipped')">
                    <div class="role-icon">&#128200;</div>
                    <h3>PLAN</h3>
                    <ul class="role-tasks">
                        <li>Capacity</li>
                        <li>Growth</li>
                        <li>Budget</li>
                    </ul>
                </div>
            </div>
            <div class="salary-box">
                <div class="salary-icon">&#128176;</div>
                <div class="salary-info">
                    <div class="salary-range">Average Salary: ₱30,000 - ₱80,000/month</div>
                    <div class="salary-certs">Certifications: CCNA, CompTIA Network+, MCSA</div>
                </div>
            </div>
        </div>

        <!-- SLIDE 4: OSI Model -->
        <div class="slide" data-slide="4">
            <h2 class="slide-title">&#128202; THE OSI MODEL - 7 LAYERS</h2>
            <p class="slide-subtitle">Click each layer to learn more!</p>
            <div class="osi-model">
                <div class="osi-layer layer-7" onclick="showLayerInfo(7)">
                    <div class="layer-number">7</div>
                    <div class="layer-name">APPLICATION</div>
                    <div class="layer-icon">&#127760;</div>
                    <div class="layer-protocols">HTTP, FTP, DNS, SMTP</div>
                </div>
                <div class="osi-layer layer-6" onclick="showLayerInfo(6)">
                    <div class="layer-number">6</div>
                    <div class="layer-name">PRESENTATION</div>
                    <div class="layer-icon">&#128274;</div>
                    <div class="layer-protocols">SSL/TLS, Encryption</div>
                </div>
                <div class="osi-layer layer-5" onclick="showLayerInfo(5)">
                    <div class="layer-number">5</div>
                    <div class="layer-name">SESSION</div>
                    <div class="layer-icon">&#129309;</div>
                    <div class="layer-protocols">NetBIOS, RPC</div>
                </div>
                <div class="osi-layer layer-4" onclick="showLayerInfo(4)">
                    <div class="layer-number">4</div>
                    <div class="layer-name">TRANSPORT</div>
                    <div class="layer-icon">&#128230;</div>
                    <div class="layer-protocols">TCP, UDP, Ports</div>
                </div>
                <div class="osi-layer layer-3" onclick="showLayerInfo(3)">
                    <div class="layer-number">3</div>
                    <div class="layer-name">NETWORK</div>
                    <div class="layer-icon">&#128506;</div>
                    <div class="layer-protocols">IP, ICMP, Routers</div>
                </div>
                <div class="osi-layer layer-2" onclick="showLayerInfo(2)">
                    <div class="layer-number">2</div>
                    <div class="layer-name">DATA LINK</div>
                    <div class="layer-icon">&#128279;</div>
                    <div class="layer-protocols">MAC, Switches, Frames</div>
                </div>
                <div class="osi-layer layer-1" onclick="showLayerInfo(1)">
                    <div class="layer-number">1</div>
                    <div class="layer-name">PHYSICAL</div>
                    <div class="layer-icon">&#9889;</div>
                    <div class="layer-protocols">Cables, Hubs, Signals</div>
                </div>
            </div>
            <div class="remember-box">
                <p>&#128161; REMEMBER: "Please Do Not Throw Sausage Pizza Away"<br>
                (Physical, Data Link, Network, Transport, Session, Presentation, Application)</p>
            </div>
        </div>

        <!-- SLIDE 5: TCP/IP vs OSI -->
        <div class="slide" data-slide="5">
            <h2 class="slide-title">OSI MODEL vs TCP/IP MODEL</h2>
            <div class="model-comparison">
                <div class="model-column osi-column">
                    <div class="model-title">OSI Model (7 Layers)</div>
                    <div class="model-layer layer-7">7. Application</div>
                    <div class="model-layer layer-6">6. Presentation</div>
                    <div class="model-layer layer-5">5. Session</div>
                    <div class="model-layer layer-4">4. Transport</div>
                    <div class="model-layer layer-3">3. Network</div>
                    <div class="model-layer layer-2">2. Data Link</div>
                    <div class="model-layer layer-1">1. Physical</div>
                </div>
                <div class="comparison-arrows">
                    <span class="comparison-arrow">&#8594;</span>
                    <span class="comparison-arrow">&#8594;</span>
                    <span class="comparison-arrow">&#8594;</span>
                    <span class="comparison-arrow">&#8594;</span>
                </div>
                <div class="model-column tcpip-column">
                    <div class="model-title">TCP/IP Model (4 Layers)</div>
                    <div class="model-layer tcpip-app">Application<br><small>HTTP, FTP, DNS, SMTP</small></div>
                    <div class="model-layer tcpip-transport">Transport<br><small>TCP, UDP</small></div>
                    <div class="model-layer tcpip-internet">Internet<br><small>IP, ICMP</small></div>
                    <div class="model-layer tcpip-network">Network Access<br><small>Ethernet</small></div>
                </div>
            </div>
            <div class="definition-box">
                <div class="def-icon">&#128273;</div>
                <div class="def-content">
                    <strong>KEY INSIGHT</strong>
                    <p><span class="key-term">TCP/IP</span> is the PRACTICAL model used on the Internet.<br>
                    <span class="key-term">OSI</span> is the THEORETICAL reference model for learning.</p>
                </div>
            </div>
        </div>

        <!-- SLIDE 6: Common Ports -->
        <div class="slide" data-slide="6">
            <h2 class="slide-title">&#128268; COMMON PORTS TO MEMORIZE</h2>
            <div class="port-table-container">
                <table class="port-table">
                    <thead>
                        <tr>
                            <th>Port</th>
                            <th>Service</th>
                            <th>Protocol</th>
                            <th>Remember</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td class="port-number">20/21</td><td>FTP</td><td>TCP</td><td>&#128193; Files</td></tr>
                        <tr><td class="port-number">22</td><td>SSH</td><td>TCP</td><td>&#128274; Secure Shell</td></tr>
                        <tr><td class="port-number">23</td><td>Telnet</td><td>TCP</td><td>&#9888; Insecure!</td></tr>
                        <tr><td class="port-number">25</td><td>SMTP</td><td>TCP</td><td>&#128231; Email Send</td></tr>
                        <tr><td class="port-number">53</td><td>DNS</td><td>TCP/UDP</td><td>&#127760; Names</td></tr>
                        <tr><td class="port-number">67/68</td><td>DHCP</td><td>UDP</td><td>&#128205; Auto IP</td></tr>
                        <tr><td class="port-number">80</td><td>HTTP</td><td>TCP</td><td>&#127760; Web</td></tr>
                        <tr><td class="port-number">443</td><td>HTTPS</td><td>TCP</td><td>&#128274; Secure Web</td></tr>
                        <tr><td class="port-number">3389</td><td>RDP</td><td>TCP</td><td>&#128421; Remote Desktop</td></tr>
                    </tbody>
                </table>
            </div>
            <div class="remember-box">
                <p>&#128161; MUST REMEMBER: HTTP = 80, HTTPS = 443, SSH = 22, DNS = 53</p>
            </div>
        </div>

        <!-- SLIDE 7: Lab Environment Setup -->
        <div class="slide" data-slide="7">
            <h2 class="slide-title">&#128736; LAB ENVIRONMENT SETUP</h2>
            <div class="setup-steps">
                <div class="setup-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <div class="step-icon">&#128187;</div>
                        <div class="step-info">
                            <strong>Install VirtualBox</strong>
                            <code>virtualbox.org</code>
                            <ul class="step-checklist">
                                <li>Create Host-Only Network</li>
                                <li>Create NAT Network</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="setup-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <div class="step-icon">&#128230;</div>
                        <div class="step-info">
                            <strong>Install Cisco Packet Tracer</strong>
                            <code>netacad.com</code>
                            <ul class="step-checklist">
                                <li>Create NetAcad account</li>
                                <li>Download Packet Tracer</li>
                                <li>Complete basic tutorial</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="setup-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <div class="step-icon">&#128190;</div>
                        <div class="step-info">
                            <strong>Download OS Images</strong>
                            <ul class="step-checklist">
                                <li>Windows Server 2022 (Evaluation)</li>
                                <li>Ubuntu Server 22.04 LTS</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SLIDE 8: Essential Network Commands -->
        <div class="slide" data-slide="8">
            <h2 class="slide-title">&#9000; ESSENTIAL NETWORK COMMANDS</h2>
            <div class="terminal-window">
                <div class="terminal-header">
                    <span class="terminal-btn red"></span>
                    <span class="terminal-btn yellow"></span>
                    <span class="terminal-btn green"></span>
                    <span class="terminal-title">Command Prompt</span>
                </div>
                <div class="terminal-body">
                    <div class="terminal-line"><span class="comment"># 1. Test connectivity</span></div>
                    <div class="terminal-line">
                        <span class="prompt">C:\&gt;</span>
                        <span class="command">ping 8.8.8.8</span>
                        <button class="copy-btn" onclick="copyCommand('ping 8.8.8.8')">&#128203;</button>
                    </div>
                    <div class="terminal-line output">Reply from 8.8.8.8: bytes=32 time=15ms TTL=117</div>

                    <div class="terminal-line"><span class="comment"># 2. View IP configuration</span></div>
                    <div class="terminal-line">
                        <span class="prompt">C:\&gt;</span>
                        <span class="command">ipconfig /all</span>
                        <button class="copy-btn" onclick="copyCommand('ipconfig /all')">&#128203;</button>
                    </div>

                    <div class="terminal-line"><span class="comment"># 3. Trace route to destination</span></div>
                    <div class="terminal-line">
                        <span class="prompt">C:\&gt;</span>
                        <span class="command">tracert google.com</span>
                        <button class="copy-btn" onclick="copyCommand('tracert google.com')">&#128203;</button>
                    </div>

                    <div class="terminal-line"><span class="comment"># 4. DNS lookup</span></div>
                    <div class="terminal-line">
                        <span class="prompt">C:\&gt;</span>
                        <span class="command">nslookup google.com</span>
                        <button class="copy-btn" onclick="copyCommand('nslookup google.com')">&#128203;</button>
                    </div>
                </div>
            </div>
            <div class="remember-box">
                <p>&#128161; TROUBLESHOOTING ORDER: ping &#8594; ipconfig &#8594; tracert &#8594; nslookup</p>
            </div>
        </div>

        <!-- SLIDE 9: Key Definitions -->
        <div class="slide" data-slide="9">
            <h2 class="slide-title">&#128273; KEY DEFINITIONS</h2>
            <div class="definitions-grid">
                <div class="definition-card">
                    <div class="def-term">OSI MODEL</div>
                    <p>A 7-layer conceptual framework for understanding how data travels across a network.</p>
                </div>
                <div class="definition-card">
                    <div class="def-term">TCP/IP MODEL</div>
                    <p>A 4-layer practical model used on the Internet. Layers: Application, Transport, Internet, Network Access.</p>
                </div>
                <div class="definition-card">
                    <div class="def-term">PROTOCOL</div>
                    <p>A set of rules that govern how data is transmitted between devices on a network.</p>
                </div>
                <div class="definition-card">
                    <div class="def-term">IP ADDRESS</div>
                    <p>A unique numerical identifier assigned to each device on a network (e.g., 192.168.1.1).</p>
                </div>
            </div>
            <div class="key-points-box">
                <h4>&#128161; KEY POINTS TO REMEMBER:</h4>
                <ul>
                    <li>Layer 3 (Network) = IP addresses, Routers</li>
                    <li>Layer 2 (Data Link) = MAC addresses, Switches</li>
                    <li>Layer 1 (Physical) = Cables, Signals</li>
                </ul>
            </div>
        </div>

        <!-- SLIDE 10: Summary -->
        <div class="slide" data-slide="10">
            <h2 class="slide-title">&#128221; KEY TAKEAWAYS</h2>
            <div class="takeaways-grid">
                <div class="takeaway-card"><span class="takeaway-icon">&#128104;&#8205;&#128187;</span><span class="key-term">NETWORK ADMIN</span><p>Maintain, Secure, Monitor</p></div>
                <div class="takeaway-card"><span class="takeaway-icon">&#128202;</span><span class="key-term">OSI MODEL</span><p>7 Layers</p></div>
                <div class="takeaway-card"><span class="takeaway-icon">&#127760;</span><span class="key-term">TCP/IP</span><p>4 Layers (Practical)</p></div>
                <div class="takeaway-card"><span class="takeaway-icon">&#128268;</span><span class="key-term">PORTS</span><p>80, 443, 22, 53</p></div>
                <div class="takeaway-card"><span class="takeaway-icon">&#128421;</span><span class="key-term">COMMANDS</span><p>ping, ipconfig, tracert</p></div>
            </div>
            <div class="next-session-box">
                <span class="next-icon">&#128640;</span>
                <div class="next-content">
                    <strong>NEXT: Network Topology and Simulation</strong>
                    <p>Building your first network in Packet Tracer</p>
                </div>
            </div>
            <div class="activities-preview">
                <h4>&#128203; TODAY'S ACTIVITIES:</h4>
                <ol>
                    <li>1.1 - Install and Configure VirtualBox</li>
                    <li>1.2 - Install Cisco Packet Tracer</li>
                    <li>1.3 - Network Commands Practice</li>
                </ol>
            </div>
            <div class="completion-badge">
                <span>&#127881;</span> Great job! You're ready for Network Administration! <span>&#127881;</span>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="slide-navigation">
        <button class="nav-btn prev-btn" onclick="prevSlide()" id="prevBtn">&#10094; Previous</button>
        <div class="slide-dots" id="slideDots"></div>
        <button class="nav-btn next-btn" onclick="nextSlide()" id="nextBtn">Next &#10095;</button>
    </div>

    <a href="{{ url_for('subject_detail', id=session.subject_id) }}" class="back-to-sessions">&#8592; Back to Sessions</a>
</div>
{% endif %}
<!-- end slides lock -->

<!-- Slides Completion & Next Steps (students only) -->
{% if current_user.role == 'student' and progress %}
<div style="max-width: 1100px; margin: 1.5rem auto; padding: 0 20px;">
    <div style="background: white; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); padding: 1.5rem; text-align: center;">
        {% if progress.get('step_slides') %}
        <div style="margin-bottom: 1rem;">
            <span style="background: #ECFDF5; color: #065F46; padding: 8px 16px; border-radius: 20px; font-weight: 600;">
                <i class="fas fa-check-circle" style="color: #10B981;"></i> Slides completed
            </span>
        </div>
        {% if session.reading_materials %}
            {% if progress.get('step_reading') %}
            <a href="{{ url_for('student_session_activities', session_id=session.id) }}" class="btn btn-primary" style="padding: 10px 24px;">
                <i class="fas fa-arrow-right"></i> Go to Activities
            </a>
            {% else %}
            <a href="{{ url_for('session_reading', session_id=session.id) }}" class="btn btn-primary" style="padding: 10px 24px;">
                <i class="fas fa-book-reader"></i> Go to Reading Materials
            </a>
            {% endif %}
        {% else %}
        <a href="{{ url_for('student_session_activities', session_id=session.id) }}" class="btn btn-primary" style="padding: 10px 24px;">
            <i class="fas fa-arrow-right"></i> Go to Activities
        </a>
        {% endif %}
        {% elif progress.get('step_video') %}
        <p style="color: #64748B; margin: 0 0 12px;">You've finished the slides. Mark them as read to proceed.</p>
        <button id="markSlidesBtn" class="btn btn-success" onclick="markSlidesComplete({{ session.id }})" style="padding: 10px 24px; font-size: 1rem;">
            <i class="fas fa-check"></i> Mark Slides as Read
        </button>
        {% else %}
        <p style="color: #94A3B8; margin: 0;">
            <i class="fas fa-lock"></i> Complete the video first to unlock the slides completion step.
        </p>
        {% endif %}
    </div>
</div>
{% endif %}

<style>
:root {
    --primary: #10B981;
    --primary-dark: #059669;
    --primary-light: #D1FAE5;
    --accent-emerald: #10B981;
    --accent-teal: #14B8A6;
    --accent-cyan: #06B6D4;
    --accent-orange: #F59E0B;
    --accent-red: #EF4444;
    --dark: #1E293B;
    --white: #FFFFFF;
    --gray-100: #F1F5F9;
    --gray-200: #E2E8F0;
    --gray-500: #64748B;

    /* OSI Layer Colors */
    --layer-7: #DC2626;
    --layer-6: #8B5CF6;
    --layer-5: #DB2777;
    --layer-4: #D97706;
    --layer-3: #059669;
    --layer-2: #2563EB;
    --layer-1: #7C3AED;
}

.lesson-wrapper { max-width: 1100px; margin: 0 auto; padding: 20px; }

/* Progress Bar */
.progress-container { position: fixed; top: 60px; left: 0; right: 0; height: 4px; background: var(--gray-200); z-index: 100; }
.progress-bar { height: 100%; background: linear-gradient(90deg, var(--primary), var(--accent-teal)); width: 10%; transition: width 0.3s; }
.progress-text { position: absolute; right: 20px; top: 8px; font-size: 0.85rem; color: var(--gray-500); background: var(--white); padding: 2px 8px; border-radius: 10px; }

/* Slides */
.slides-container { min-height: 600px; position: relative; margin-top: 30px; }
.slide { display: none; animation: fadeIn 0.5s; padding: 30px; background: var(--white); border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); min-height: 550px; }
.slide.active { display: block; }

/* Slide 1: Title */
.slide[data-slide="1"] { background: linear-gradient(135deg, #10B981 0%, #059669 50%, #047857 100%); background-size: 200% 200%; animation: gradientMove 8s ease infinite; position: relative; overflow: hidden; text-align: center; color: var(--white); }
.slide[data-slide="1"].active { display: flex; flex-direction: column; justify-content: center; align-items: center; }
@keyframes gradientMove { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

.floating-symbols { position: absolute; width: 100%; height: 100%; pointer-events: none; }
.symbol { position: absolute; font-family: monospace; font-size: 1.5rem; color: rgba(255,255,255,0.3); left: var(--x); top: var(--y); animation: float 3s ease-in-out infinite; animation-delay: var(--delay); }
@keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }

.course-badge { background: rgba(255,255,255,0.2); padding: 8px 20px; border-radius: 30px; font-size: 0.9rem; margin-bottom: 30px; }
.main-title { font-size: 2.5rem; margin: 5px 0; text-shadow: 2px 2px 10px rgba(0,0,0,0.2); }
.subtitle { font-size: 1.2rem; margin-top: 20px; opacity: 0; animation: fadeIn 1s ease forwards 2s; }
.start-btn { margin-top: 40px; padding: 15px 40px; font-size: 1.1rem; background: var(--white); color: var(--primary); border: none; border-radius: 50px; cursor: pointer; font-weight: 600; display: flex; align-items: center; gap: 10px; animation: pulse 2s infinite; }
@keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }

/* Slide Header & Content */
.slide-header { text-align: center; margin-bottom: 30px; }
.lightbulb-icon { font-size: 3rem; animation: glow 2s infinite; }
@keyframes glow { 0%, 100% { text-shadow: 0 0 10px rgba(16, 185, 129, 0.5); } 50% { text-shadow: 0 0 30px rgba(16, 185, 129, 0.8); } }
.slide-title { text-align: center; font-size: 1.8rem; margin-bottom: 25px; color: var(--dark); }
.slide-subtitle { text-align: center; color: var(--gray-500); margin-bottom: 20px; }

/* Objectives */
.objectives-container { display: flex; flex-direction: column; gap: 15px; max-width: 700px; margin: 0 auto; }
.objective-card { display: flex; align-items: center; gap: 15px; background: var(--gray-100); padding: 18px; border-radius: 12px; opacity: 0; transform: translateX(-30px); animation: slideInLeft 0.5s ease forwards; animation-delay: var(--delay); }
@keyframes slideInLeft { to { opacity: 1; transform: translateX(0); } }
.obj-number { width: 36px; height: 36px; background: linear-gradient(135deg, var(--primary), var(--accent-teal)); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; }
.obj-icon { font-size: 1.8rem; }
.obj-content { flex: 1; }
.obj-content p { margin: 5px 0 0; color: var(--gray-500); }
.obj-check { color: var(--primary); font-size: 1.5rem; font-weight: bold; }

/* Key Terms */
.key-term { background: linear-gradient(135deg, var(--primary), var(--accent-teal)); color: white; padding: 4px 12px; border-radius: 6px; font-weight: bold; display: inline-block; font-size: 0.9rem; }

/* Role Grid */
.role-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0; }
.role-card { background: var(--gray-100); border-radius: 12px; padding: 20px; text-align: center; cursor: pointer; transition: all 0.3s; border: 2px solid transparent; }
.role-card:hover { transform: translateY(-5px); border-color: var(--primary); box-shadow: 0 10px 30px rgba(16, 185, 129, 0.2); }
.role-icon { font-size: 2.5rem; margin-bottom: 10px; }
.role-card h3 { color: var(--primary-dark); margin-bottom: 10px; font-size: 1rem; }
.role-tasks { list-style: none; text-align: left; font-size: 0.85rem; color: var(--gray-500); }
.role-tasks li { padding: 3px 0; }

/* Salary Box */
.salary-box { background: linear-gradient(135deg, var(--primary), var(--accent-teal)); color: white; padding: 20px; border-radius: 12px; display: flex; align-items: center; gap: 20px; margin-top: 20px; }
.salary-icon { font-size: 2.5rem; }
.salary-range { font-size: 1.2rem; font-weight: bold; }
.salary-certs { opacity: 0.9; font-size: 0.9rem; margin-top: 5px; }

/* OSI Model */
.osi-model { max-width: 600px; margin: 0 auto; }
.osi-layer { display: flex; align-items: center; margin-bottom: 8px; border-radius: 8px; overflow: hidden; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
.osi-layer:hover { transform: scale(1.02); box-shadow: 0 5px 20px rgba(0,0,0,0.2); }
.layer-number { width: 40px; padding: 12px; text-align: center; font-weight: bold; font-size: 1.2rem; color: white; }
.layer-name { flex: 1; padding: 12px; font-weight: 600; color: white; text-transform: uppercase; letter-spacing: 1px; font-size: 0.9rem; }
.layer-icon { padding: 12px; font-size: 1.3rem; }
.layer-protocols { padding: 12px; font-size: 0.8rem; color: rgba(255,255,255,0.9); }

.layer-7 { background: var(--layer-7); }
.layer-6 { background: var(--layer-6); }
.layer-5 { background: var(--layer-5); }
.layer-4 { background: var(--layer-4); }
.layer-3 { background: var(--layer-3); }
.layer-2 { background: var(--layer-2); }
.layer-1 { background: var(--layer-1); }

/* Model Comparison */
.model-comparison { display: grid; grid-template-columns: 1fr auto 1fr; gap: 20px; align-items: start; margin: 20px 0; }
.model-column { display: flex; flex-direction: column; gap: 5px; }
.model-title { text-align: center; font-weight: bold; padding: 12px; background: var(--dark); color: white; border-radius: 8px; margin-bottom: 10px; }
.model-layer { padding: 10px 15px; border-radius: 6px; text-align: center; font-weight: 500; color: white; font-size: 0.85rem; }
.comparison-arrows { display: flex; flex-direction: column; justify-content: space-around; padding-top: 50px; gap: 30px; }
.comparison-arrow { font-size: 1.5rem; color: var(--gray-500); }

.tcpip-app { background: linear-gradient(135deg, var(--layer-7), var(--layer-5)); padding: 30px 15px; }
.tcpip-transport { background: var(--layer-4); }
.tcpip-internet { background: var(--layer-3); }
.tcpip-network { background: linear-gradient(135deg, var(--layer-2), var(--layer-1)); padding: 20px 15px; }

/* Definition Box */
.definition-box { background: var(--primary-light); border-left: 4px solid var(--primary); padding: 18px 22px; border-radius: 0 12px 12px 0; margin-top: 25px; display: flex; gap: 15px; align-items: flex-start; }
.def-icon { font-size: 1.5rem; }
.def-content strong { color: var(--primary-dark); }

/* Port Table */
.port-table-container { overflow-x: auto; margin: 20px 0; }
.port-table { width: 100%; border-collapse: collapse; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
.port-table th { background: linear-gradient(135deg, var(--primary-dark), var(--primary)); color: white; padding: 15px; text-align: left; }
.port-table td { padding: 12px 15px; border-bottom: 1px solid var(--gray-200); }
.port-table tr:hover { background: var(--primary-light); }
.port-number { font-family: monospace; font-weight: bold; color: var(--primary-dark); font-size: 1.1rem; }

/* Setup Steps */
.setup-steps { display: flex; flex-direction: column; gap: 20px; }
.setup-step { display: flex; align-items: flex-start; gap: 20px; background: var(--gray-100); padding: 20px; border-radius: 12px; border-left: 4px solid var(--primary); }
.step-number { width: 40px; height: 40px; background: linear-gradient(135deg, var(--primary), var(--accent-teal)); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem; flex-shrink: 0; }
.step-content { display: flex; gap: 15px; flex: 1; }
.step-icon { font-size: 2.5rem; }
.step-info { flex: 1; }
.step-info strong { display: block; color: var(--dark); margin-bottom: 5px; }
.step-info code { display: inline-block; background: var(--dark); color: var(--primary); padding: 4px 10px; border-radius: 4px; font-size: 0.85rem; margin: 5px 0; }
.step-checklist { list-style: none; margin-top: 10px; }
.step-checklist li { padding: 4px 0; padding-left: 20px; position: relative; color: var(--gray-500); }
.step-checklist li::before { content: "\\2713"; color: var(--primary); position: absolute; left: 0; font-weight: bold; }

/* Terminal */
.terminal-window { background: #1E1E1E; border-radius: 12px; overflow: hidden; max-width: 700px; margin: 0 auto; box-shadow: 0 10px 40px rgba(0,0,0,0.3); }
.terminal-header { background: #323232; padding: 10px 15px; display: flex; align-items: center; gap: 8px; }
.terminal-btn { width: 12px; height: 12px; border-radius: 50%; }
.terminal-btn.red { background: #FF5F56; }
.terminal-btn.yellow { background: #FFBD2E; }
.terminal-btn.green { background: #27C93F; }
.terminal-title { flex: 1; text-align: center; color: #888; font-size: 0.8rem; }
.terminal-body { padding: 20px; font-family: 'Consolas', 'Monaco', monospace; font-size: 0.9rem; }
.terminal-line { margin: 8px 0; display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
.terminal-line .comment { color: #6A9955; width: 100%; }
.terminal-line .prompt { color: #569CD6; }
.terminal-line .command { color: #DCDCAA; }
.terminal-line .output { color: #4EC9B0; width: 100%; padding-left: 20px; }
.copy-btn { background: transparent; border: 1px solid #555; color: #888; padding: 4px 10px; border-radius: 4px; cursor: pointer; font-size: 0.75rem; margin-left: auto; }
.copy-btn:hover { background: #555; color: white; }

/* Remember Box */
.remember-box { background: linear-gradient(135deg, #FEF3C7, #FDE68A); border: 2px solid var(--accent-orange); border-radius: 12px; padding: 15px 20px; margin-top: 20px; text-align: center; }

/* Definitions Grid */
.definitions-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 20px 0; }
.definition-card { background: var(--gray-100); border-radius: 12px; padding: 20px; border-left: 4px solid var(--primary); }
.def-term { font-weight: bold; color: var(--primary-dark); font-size: 1.1rem; margin-bottom: 8px; }
.definition-card p { color: var(--gray-500); font-size: 0.9rem; line-height: 1.5; }

.key-points-box { background: var(--primary-light); border-radius: 12px; padding: 20px; margin-top: 20px; }
.key-points-box h4 { color: var(--primary-dark); margin-bottom: 10px; }
.key-points-box ul { margin-left: 20px; color: var(--dark); }
.key-points-box li { padding: 5px 0; }

/* Summary */
.takeaways-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin-bottom: 20px; }
.takeaway-card { background: var(--gray-100); border-radius: 10px; padding: 15px; text-align: center; transition: transform 0.3s; }
.takeaway-card:hover { transform: translateY(-5px); }
.takeaway-icon { font-size: 1.8rem; display: block; margin-bottom: 8px; }
.takeaway-card p { margin: 8px 0 0; color: var(--gray-500); font-size: 0.8rem; }
.next-session-box { background: linear-gradient(135deg, var(--primary), var(--accent-teal)); color: white; border-radius: 12px; padding: 18px; display: flex; gap: 15px; align-items: center; margin-bottom: 15px; }
.next-icon { font-size: 2rem; }
.next-content strong { font-size: 1rem; }
.next-content p { margin: 4px 0 0; opacity: 0.9; font-size: 0.85rem; }
.activities-preview { background: var(--gray-100); border-radius: 10px; padding: 15px; margin-bottom: 15px; }
.activities-preview h4 { margin: 0 0 8px; font-size: 0.95rem; }
.activities-preview ol { margin: 0; padding-left: 22px; font-size: 0.9rem; }
.activities-preview li { margin: 4px 0; }
.completion-badge { text-align: center; padding: 15px; background: linear-gradient(135deg, var(--primary-light), #A7F3D0); border-radius: 50px; font-size: 1.1rem; font-weight: bold; color: #047857; }

/* Navigation */
.slide-navigation { display: flex; justify-content: space-between; align-items: center; margin-top: 25px; padding: 18px; background: var(--gray-100); border-radius: 12px; }
.nav-btn { padding: 10px 22px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s; font-size: 0.95rem; }
.prev-btn { background: var(--gray-200); color: var(--dark); }
.next-btn { background: var(--primary); color: white; }
.nav-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
.nav-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
.slide-dots { display: flex; gap: 6px; }
.slide-dot { width: 10px; height: 10px; border-radius: 50%; background: var(--gray-200); cursor: pointer; transition: all 0.3s; }
.slide-dot.active { background: var(--primary); transform: scale(1.2); }
.back-to-sessions { display: inline-block; margin-top: 18px; color: var(--gray-500); text-decoration: none; font-weight: 500; }
.back-to-sessions:hover { color: var(--primary); }

@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

@media (max-width: 768px) {
    .main-title { font-size: 1.6rem; }
    .role-grid { grid-template-columns: repeat(2, 1fr); }
    .definitions-grid { grid-template-columns: 1fr; }
    .model-comparison { grid-template-columns: 1fr; }
    .comparison-arrows { display: none; }
}
</style>

<script>
let currentSlide = 1;
const totalSlides = 10;

document.addEventListener('DOMContentLoaded', function() {
    createDots();
    updateNavigation();
    document.addEventListener('keydown', function(e) {
        if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextSlide(); }
        else if (e.key === 'ArrowLeft') { e.preventDefault(); prevSlide(); }
    });
});

function createDots() {
    const dotsContainer = document.getElementById('slideDots');
    for (let i = 1; i <= totalSlides; i++) {
        const dot = document.createElement('div');
        dot.className = 'slide-dot' + (i === 1 ? ' active' : '');
        dot.onclick = () => goToSlide(i);
        dotsContainer.appendChild(dot);
    }
}

function updateNavigation() {
    document.getElementById('currentSlide').textContent = currentSlide;
    document.getElementById('prevBtn').disabled = currentSlide === 1;
    document.getElementById('nextBtn').disabled = currentSlide === totalSlides;
    document.getElementById('progressBar').style.width = (currentSlide / totalSlides * 100) + '%';
    document.querySelectorAll('.slide-dot').forEach((dot, i) => dot.classList.toggle('active', i + 1 === currentSlide));
}

function goToSlide(n) {
    document.querySelectorAll('.slide').forEach(s => s.classList.remove('active'));
    currentSlide = n;
    document.querySelector(`[data-slide="${n}"]`).classList.add('active');
    updateNavigation();
}

function nextSlide() { if (currentSlide < totalSlides) goToSlide(currentSlide + 1); }
function prevSlide() { if (currentSlide > 1) goToSlide(currentSlide - 1); }

function copyCommand(text) {
    navigator.clipboard.writeText(text).then(() => {
        const btn = event.target;
        const orig = btn.innerHTML;
        btn.textContent = 'Copied!';
        setTimeout(() => btn.innerHTML = orig, 1000);
    });
}

function showLayerInfo(layer) {
    const info = {
        7: 'APPLICATION: Where users interact with network services (HTTP, FTP, DNS, SMTP)',
        6: 'PRESENTATION: Handles data formatting, encryption, and compression (SSL/TLS)',
        5: 'SESSION: Manages connections between applications (NetBIOS, RPC)',
        4: 'TRANSPORT: Ensures reliable data delivery with ports (TCP, UDP)',
        3: 'NETWORK: Handles logical addressing and routing (IP, ICMP, Routers)',
        2: 'DATA LINK: Manages physical addressing and frames (MAC, Switches)',
        1: 'PHYSICAL: Transmits raw bits over physical media (Cables, Hubs, Signals)'
    };
    alert('Layer ' + layer + ': ' + info[layer]);
}

// ==================== YouTube IFrame API + Heartbeat ====================
{% if session.youtube_url %}
var ytPlayer;
var heartbeatInterval = null;
var sessionId = {{ session.id }};
var videoCompleted = {{ 'true' if video_watched else 'false' }};
var watchedSeconds = {{ video_watch_seconds }};

var tag = document.createElement('script');
tag.src = "https://www.youtube.com/iframe_api";
var firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

var embedUrl = "{{ session.youtube_url | youtube_embed }}";
var videoId = embedUrl.split('/embed/')[1];
if (videoId && videoId.includes('?')) videoId = videoId.split('?')[0];

function onYouTubeIframeAPIReady() {
    ytPlayer = new YT.Player('ytPlayer', {
        videoId: videoId,
        playerVars: { 'rel': 0, 'modestbranding': 1, 'disablekb': {{ '0' if video_watched else '1' }} },
        events: { 'onReady': onPlayerReady, 'onStateChange': onPlayerStateChange }
    });
}
function onPlayerReady(event) {
    var duration = ytPlayer.getDuration();
    var el = document.getElementById('totalDuration');
    if (el) { var m = Math.floor(duration/60), s = Math.floor(duration%60); el.textContent = m+':'+(s<10?'0':'')+s; }
    if (document.getElementById('watchProgressFill') && duration > 0) {
        document.getElementById('watchProgressFill').style.width = Math.min(100,(watchedSeconds/duration)*100)+'%';
    }
}
function onPlayerStateChange(event) {
    if (videoCompleted) return;
    if (event.data === YT.PlayerState.PLAYING) { if (!heartbeatInterval) heartbeatInterval = setInterval(sendHeartbeat, 5000); }
    else { if (heartbeatInterval) { clearInterval(heartbeatInterval); heartbeatInterval = null; } sendHeartbeat(); }
}
async function sendHeartbeat() {
    if (!ytPlayer || videoCompleted) return;
    try {
        var ct = Math.floor(ytPlayer.getCurrentTime()), dur = Math.floor(ytPlayer.getDuration());
        if (dur <= 0) return;
        var r = await fetch('/api/session/video-heartbeat', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({session_id:sessionId, current_time:ct, duration:dur}) });
        if (r.redirected || r.url.includes('/login')) return;
        var d = await r.json();
        if (d.success) {
            watchedSeconds = d.watched_seconds;
            var el = document.getElementById('watchedTime');
            if (el) { var m=Math.floor(watchedSeconds/60),s=Math.floor(watchedSeconds%60); el.textContent=m+':'+(s<10?'0':'')+s; }
            var fill = document.getElementById('watchProgressFill');
            if (fill && dur>0) fill.style.width = Math.min(100,(watchedSeconds/dur)*100)+'%';
            if (d.completed) { videoCompleted=true; if(heartbeatInterval){clearInterval(heartbeatInterval);heartbeatInterval=null;} location.reload(); }
        }
    } catch(e) { console.error('Heartbeat error:',e); }
}
{% endif %}

async function markSlidesComplete(sid) {
    var btn = document.getElementById('markSlidesBtn');
    if (!btn) return;
    btn.disabled = true; btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
    try {
        var r = await fetch('/api/session/complete-slides', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({session_id:sid}) });
        if (r.redirected || r.url.includes('/login')) { alert('Session expired.'); window.location.href='/login'; return; }
        var d = await r.json();
        if (d.success) location.reload();
        else { alert(d.error||'Error'); btn.disabled=false; btn.innerHTML='<i class="fas fa-check"></i> Mark Slides as Read'; }
    } catch(e) { alert('Error: '+e.message); btn.disabled=false; btn.innerHTML='<i class="fas fa-check"></i> Mark Slides as Read'; }
}
</script>
{% endblock %}
