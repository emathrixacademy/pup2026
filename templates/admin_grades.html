{% extends 'base.html' %}

{% block title %}Grades Overview - Sangrenes LMS Portal{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <h1><i class="fas fa-chart-line"></i> Grades & Performance Overview</h1>
        <p>Academic performance across all subjects and students</p>
    </div>
</div>

<!-- Per-Subject Summary -->
<div style="background:white;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.06);overflow:hidden;margin-bottom:24px;">
    <div style="padding:16px 20px;border-bottom:1px solid #E2E8F0;">
        <h3 style="margin:0;font-size:1rem;"><i class="fas fa-book" style="color:#3B82F6;"></i> Subject Grade Summary</h3>
    </div>
    <div style="overflow-x:auto;">
        <table style="width:100%;border-collapse:collapse;">
            <thead>
                <tr style="background:#F8FAFC;">
                    <th style="padding:10px 14px;text-align:left;font-size:0.8rem;color:#64748B;">Subject</th>
                    <th style="padding:10px 14px;text-align:center;font-size:0.8rem;color:#64748B;">Section</th>
                    <th style="padding:10px 14px;text-align:center;font-size:0.8rem;color:#64748B;">Enrolled</th>
                    <th style="padding:10px 14px;text-align:center;font-size:0.8rem;color:#64748B;">Avg Activity</th>
                    <th style="padding:10px 14px;text-align:center;font-size:0.8rem;color:#64748B;">Avg Quiz</th>
                    <th style="padding:10px 14px;text-align:center;font-size:0.8rem;color:#64748B;">Avg Exam</th>
                </tr>
            </thead>
            <tbody>
                {% for g in grade_summary %}
                <tr style="border-bottom:1px solid #F1F5F9;">
                    <td style="padding:10px 14px;font-weight:600;">{{ g.code }} - {{ g.name }}</td>
                    <td style="padding:10px 14px;text-align:center;"><span style="background:#EDE9FE;color:#7C3AED;padding:2px 10px;border-radius:12px;font-size:0.75rem;">{{ g.section }}</span></td>
                    <td style="padding:10px 14px;text-align:center;font-weight:600;color:#3B82F6;">{{ g.enrolled }}</td>
                    <td style="padding:10px 14px;text-align:center;">
                        {% if g.avg_activity_score %}<span style="font-weight:600;color:{% if g.avg_activity_score >= 75 %}#10B981{% else %}#EF4444{% endif %};">{{ "%.1f"|format(g.avg_activity_score) }}%</span>
                        {% else %}<span style="color:#CBD5E1;">-</span>{% endif %}
                    </td>
                    <td style="padding:10px 14px;text-align:center;">
                        {% if g.avg_quiz_score %}<span style="font-weight:600;color:{% if g.avg_quiz_score >= 75 %}#10B981{% else %}#EF4444{% endif %};">{{ "%.1f"|format(g.avg_quiz_score) }}%</span>
                        {% else %}<span style="color:#CBD5E1;">-</span>{% endif %}
                    </td>
                    <td style="padding:10px 14px;text-align:center;">
                        {% if g.avg_exam_score %}<span style="font-weight:600;color:{% if g.avg_exam_score >= 75 %}#10B981{% else %}#EF4444{% endif %};">{{ "%.1f"|format(g.avg_exam_score) }}%</span>
                        {% else %}<span style="color:#CBD5E1;">-</span>{% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Top Performers & At-Risk -->
<div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;">
    <!-- Top Students -->
    <div style="background:white;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.06);overflow:hidden;">
        <div style="padding:16px 20px;border-bottom:1px solid #E2E8F0;">
            <h3 style="margin:0;font-size:1rem;"><i class="fas fa-trophy" style="color:#F59E0B;"></i> Top Performers</h3>
        </div>
        {% if top_students %}
        <div style="max-height:400px;overflow-y:auto;">
            {% for s in top_students %}
            <div style="padding:10px 16px;border-bottom:1px solid #F1F5F9;display:flex;justify-content:space-between;align-items:center;">
                <div>
                    <div style="font-weight:600;font-size:0.85rem;">{{ s.full_name }}</div>
                    <div style="font-size:0.75rem;color:#94A3B8;">{{ s.section or '' }} &middot; {{ s.activities_done }} activities</div>
                </div>
                <div style="font-weight:700;color:#10B981;font-size:1.1rem;">{{ "%.1f"|format(s.avg_score) }}%</div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div style="padding:40px;text-align:center;color:#94A3B8;"><p>No graded submissions yet.</p></div>
        {% endif %}
    </div>

    <!-- At-Risk Students -->
    <div style="background:white;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.06);overflow:hidden;">
        <div style="padding:16px 20px;border-bottom:1px solid #E2E8F0;">
            <h3 style="margin:0;font-size:1rem;"><i class="fas fa-exclamation-triangle" style="color:#EF4444;"></i> At-Risk Students</h3>
        </div>
        {% if at_risk_students %}
        <div style="max-height:400px;overflow-y:auto;">
            {% for s in at_risk_students %}
            <div style="padding:10px 16px;border-bottom:1px solid #F1F5F9;display:flex;justify-content:space-between;align-items:center;">
                <div>
                    <div style="font-weight:600;font-size:0.85rem;">{{ s.full_name }}</div>
                    <div style="font-size:0.75rem;color:#94A3B8;">{{ s.section or '' }} &middot; {{ s.graded }} graded</div>
                </div>
                <div style="font-weight:700;color:#EF4444;font-size:1.1rem;">{{ "%.1f"|format(s.avg_score) }}%</div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div style="padding:40px;text-align:center;color:#94A3B8;"><p>No at-risk students detected.</p></div>
        {% endif %}
    </div>
</div>
{% endblock %}
